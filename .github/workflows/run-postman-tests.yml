name: Main Workflow
on:
  push:
    branches:
      - '*'

jobs:
  build:
    name: Build and Test
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      # Вызов workflow с именем "Other Workflow"
      - name: Run Other Workflow
        uses: actions/workflow_run@v2
        with:
          workflow: Other Workflow
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Install Postman CLI
        run: |
            curl -o- "https://dl-cli.pstmn.io/install/linux64.sh" | sh
      - name: Login to Postman CLI
        run: postman login --with-api-key ${{ secrets.POSTMAN_API_KEY }}
      
      - name: Run API tests
        run: |
          postman collection run "${{ github.workspace }}/postman/collections/test not authenticated logout.json" -e "19077502-1929ddfd-36b2-46a7-8e81-3ebf52eea139"
          postman collection run "${{ github.workspace }}/postman/collections/test not authenticated request.json" -e "19077502-1929ddfd-36b2-46a7-8e81-3ebf52eea139"
          postman collection run "${{ github.workspace }}/postman/collections/test not existing user's login.json" -e "19077502-1929ddfd-36b2-46a7-8e81-3ebf52eea139"
          postman collection run "${{ github.workspace }}/postman/collections/test registration already exists permanent user.json" -e "19077502-1929ddfd-36b2-46a7-8e81-3ebf52eea139"
          postman collection run "${{ github.workspace }}/postman/collections/testing permanent security.json" -e "19077502-1929ddfd-36b2-46a7-8e81-3ebf52eea139"
          postman collection run "${{ github.workspace }}/postman/collections/testing temp security.json" -e "19077502-1929ddfd-36b2-46a7-8e81-3ebf52eea139"
